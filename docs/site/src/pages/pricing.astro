---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Pricing â€” Kiln" description="Kiln pricing plans. Local printing is free forever. Pay only for fleet management or outsourced manufacturing." current="pricing">
  <section class="pricing-hero">
    <div class="container">
      <h1>Pricing</h1>
      <p class="lead">Local printing is free forever. Pay only when you need fleet management or outsourced manufacturing.</p>
    </div>
  </section>

  <section class="pricing-cards">
    <div class="container-wide">
      <div class="billing-toggle">
        <span class="toggle-label" data-period="monthly">Monthly</span>
        <label class="toggle-switch">
          <input type="checkbox" id="billing-toggle" />
          <span class="toggle-slider"></span>
        </label>
        <span class="toggle-label" data-period="annual">Annual <span class="save-badge">Save 20%</span></span>
      </div>

      <div class="cards-grid">
        <!-- Free Tier -->
        <div class="card pricing-card">
          <div class="card-header">
            <h3>Free</h3>
            <div class="price">
              <span class="amount">$0</span>
              <span class="period">/ forever</span>
            </div>
          </div>
          <ul class="features">
            <li><span class="check">&#10003;</span> Unlimited local printing</li>
            <li><span class="check">&#10003;</span> Up to 2 printers</li>
            <li><span class="check">&#10003;</span> 10-job queue</li>
            <li><span class="check">&#10003;</span> Community support</li>
            <li><span class="check">&#10003;</span> 3 fulfillment orders/month free</li>
            <li><span class="check">&#10003;</span> 5% platform fee on fulfillment</li>
          </ul>
          <a href="/install" class="btn card-cta">Let's build &#8594;</a>
        </div>

        <!-- Pro Tier -->
        <div class="card pricing-card featured">
          <div class="badge">Most Popular</div>
          <div class="card-header">
            <h3>Pro</h3>
            <div class="price">
              <span class="amount monthly-price">$29</span>
              <span class="amount annual-price" style="display:none">$23</span>
              <span class="period monthly-period">/ month</span>
              <span class="period annual-period" style="display:none">/ mo, billed annually</span>
            </div>
          </div>
          <ul class="features">
            <li><span class="check">&#10003;</span> Everything in Free</li>
            <li><span class="check">&#10003;</span> Unlimited printers</li>
            <li><span class="check">&#10003;</span> Unlimited job queue</li>
            <li><span class="check">&#10003;</span> Fleet orchestration &amp; analytics</li>
            <li><span class="check">&#10003;</span> Cloud sync</li>
            <li><span class="check">&#10003;</span> Community support</li>
            <li><span class="check">&#10003;</span> 3 fulfillment orders/month free</li>
            <li><span class="check">&#10003;</span> 5% platform fee on fulfillment</li>
          </ul>
          <a href="/install" class="btn card-cta">Get Pro &#8594;</a>
          <p class="upgrade-note">Install Kiln, then run <code>kiln upgrade</code></p>
        </div>

        <!-- Business Tier -->
        <div class="card pricing-card">
          <div class="card-header">
            <h3>Business</h3>
            <div class="price">
              <span class="amount monthly-price">$99</span>
              <span class="amount annual-price" style="display:none">$79</span>
              <span class="period monthly-period">/ month</span>
              <span class="period annual-period" style="display:none">/ mo, billed annually</span>
            </div>
          </div>
          <ul class="features">
            <li><span class="check">&#10003;</span> Everything in Pro</li>
            <li><span class="check">&#10003;</span> Up to 50 printers</li>
            <li><span class="check">&#10003;</span> 5 team seats</li>
            <li><span class="check">&#10003;</span> Unlimited fulfillment orders</li>
            <li><span class="check">&#10003;</span> Shared hosted MCP server</li>
            <li><span class="check">&#10003;</span> Priority support</li>
            <li><span class="check">&#10003;</span> Custom safety profiles</li>
            <li><span class="check">&#10003;</span> Webhook integrations</li>
          </ul>
          <a href="/install" class="btn card-cta">Get Business &#8594;</a>
          <p class="upgrade-note">Install Kiln, then run <code>kiln upgrade</code></p>
        </div>

        <!-- Enterprise Tier -->
        <div class="card pricing-card enterprise-card">
          <div class="card-header">
            <h3>Enterprise</h3>
            <div class="price">
              <span class="amount monthly-price">$499</span>
              <span class="amount annual-price" style="display:none">$399</span>
              <span class="period monthly-price-period">/ mo base</span>
              <span class="period annual-price-period" style="display:none">/ mo base, billed annually</span>
            </div>
            <p class="price-note">20 printers included, then $15/printer/mo</p>
          </div>
          <ul class="features">
            <li><span class="check">&#10003;</span> Everything in Business</li>
            <li><span class="check">&#10003;</span> Unlimited printers</li>
            <li><span class="check">&#10003;</span> Unlimited team seats</li>
            <li><span class="check">&#10003;</span> Role-based access control</li>
            <li><span class="check">&#10003;</span> Dedicated single-tenant MCP server</li>
            <li><span class="check">&#10003;</span> On-prem, cloud, or hybrid deployment</li>
            <li><span class="check">&#10003;</span> SSO (SAML/OIDC)</li>
            <li><span class="check">&#10003;</span> Full audit trail with export</li>
            <li><span class="check">&#10003;</span> Lockable safety profiles</li>
            <li><span class="check">&#10003;</span> Encrypted G-code at rest</li>
            <li><span class="check">&#10003;</span> 99.9% uptime SLA</li>
            <li><span class="check">&#10003;</span> Dedicated Slack channel + onboarding</li>
          </ul>
          <a href="mailto:adam@kiln3d.com?subject=Kiln%20Enterprise" class="btn card-cta enterprise-cta">Talk to us &#8594;</a>
        </div>
      </div>
    </div>
  </section>

  <section class="faq">
    <div class="container">
      <h2>Frequently Asked Questions</h2>
      <div class="faq-list">
        <details>
          <summary>Is local printing really free?</summary>
          <p>Yes. Kiln is open source (MIT). Local printing, slicing, and printer control are free forever with no limits on print volume.</p>
        </details>
        <details>
          <summary>What is a fulfillment order?</summary>
          <p>When you outsource manufacturing through Craftcloud via Kiln. Local printing to your own printers does not count.</p>
        </details>
        <details>
          <summary>Can I self-host everything?</summary>
          <p>Yes. Kiln runs entirely locally. Pro/Business tiers add optional cloud features but local functionality never requires a subscription.</p>
        </details>
        <details>
          <summary>Do I need a paid plan for multiple printers?</summary>
          <p>Free tier supports 2 printers. For 3+ printers, you need Pro or above.</p>
        </details>
        <details>
          <summary>What does annual billing save?</summary>
          <p>Annual plans save roughly 20% compared to monthly. Pro drops from $29/mo to $23/mo ($276/yr). Business drops from $99/mo to $79/mo ($948/yr). Enterprise drops from $499/mo to $399/mo ($4,788/yr). You can switch between monthly and annual at any time.</p>
        </details>
        <details>
          <summary>What's included in Enterprise?</summary>
          <p>Enterprise is for teams running production print operations. It includes a dedicated single-tenant MCP server, SSO, role-based access control, full audit trails, lockable safety profiles, and a 99.9% uptime SLA. Base price includes 20 printers, with additional printers at $15/mo each.</p>
        </details>
        <details>
          <summary>Can I try Enterprise before committing?</summary>
          <p>Yes. We offer a pilot program for qualified teams. Email adam@kiln3d.com and we'll set you up with full Enterprise access to evaluate.</p>
        </details>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const toggle = document.getElementById('billing-toggle');
  if (toggle) {
    toggle.addEventListener('change', () => {
      const isAnnual = toggle.checked;
      document.querySelectorAll('.monthly-price, .monthly-period, .monthly-price-period').forEach(el => {
        (el as HTMLElement).style.display = isAnnual ? 'none' : '';
      });
      document.querySelectorAll('.annual-price, .annual-period, .annual-price-period').forEach(el => {
        (el as HTMLElement).style.display = isAnnual ? '' : 'none';
      });
    });
  }
</script>

<style>
  .pricing-hero {
    text-align: center;
    padding: 100px 0 40px;
  }
  .pricing-hero h1 {
    font-size: 40px;
    font-weight: 700;
    margin-bottom: 16px;
  }
  .pricing-hero .lead {
    color: var(--text-muted);
    font-size: 17px;
    max-width: 580px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Billing toggle */
  .billing-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-bottom: 32px;
  }
  .toggle-label {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .save-badge {
    background: var(--accent);
    color: #fff;
    font-size: 11px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 10px;
    white-space: nowrap;
  }
  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
  }
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--border);
    border-radius: 24px;
    transition: 0.2s;
  }
  .toggle-slider::before {
    content: '';
    position: absolute;
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background: #fff;
    border-radius: 50%;
    transition: 0.2s;
  }
  .toggle-switch input:checked + .toggle-slider {
    background: var(--accent);
  }
  .toggle-switch input:checked + .toggle-slider::before {
    transform: translateX(20px);
  }

  /* Cards grid */
  .pricing-cards {
    padding: 20px 0 80px;
  }
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    align-items: start;
  }

  /* Card */
  .pricing-card {
    position: relative;
    display: flex;
    flex-direction: column;
    padding: 32px 28px;
  }
  .pricing-card .card-header {
    margin-bottom: 24px;
  }
  .pricing-card h3 {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text);
  }
  .price {
    display: flex;
    align-items: baseline;
    gap: 4px;
  }
  .price .amount {
    font-size: 40px;
    font-weight: 700;
    color: var(--text);
    line-height: 1;
  }
  .price .period {
    font-size: 14px;
    color: var(--text-muted);
  }
  .price-note {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 6px;
    margin-bottom: 0;
  }

  /* Features list */
  .features {
    list-style: none;
    margin-bottom: 32px;
    flex: 1;
  }
  .features li {
    padding: 6px 0;
    font-size: 13px;
    color: var(--text-muted);
    display: flex;
    align-items: flex-start;
    gap: 10px;
    line-height: 1.5;
  }
  .features .check {
    color: var(--accent);
    font-weight: 600;
    font-size: 13px;
    flex-shrink: 0;
    margin-top: 1px;
  }

  /* CTA button */
  .card-cta {
    width: 100%;
    text-align: center;
    margin-top: auto;
  }

  /* Featured card (Pro) */
  .pricing-card.featured {
    border-color: var(--accent);
    box-shadow: 0 0 40px var(--accent-glow), 0 0 80px rgba(255, 107, 43, 0.05);
  }
  .badge {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--accent);
    color: #fff;
    font-size: 12px;
    font-weight: 600;
    padding: 4px 16px;
    border-radius: 20px;
    white-space: nowrap;
  }

  /* Enterprise card */
  .enterprise-card {
    border-color: var(--text-muted);
  }
  .enterprise-cta {
    background: var(--text);
    color: var(--bg);
  }
  .enterprise-cta:hover {
    opacity: 0.9;
  }

  /* Upgrade note under CTA */
  .upgrade-note {
    text-align: center;
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 10px;
    margin-bottom: 0;
  }
  .upgrade-note code {
    font-size: 12px;
    background: var(--bg);
    padding: 2px 6px;
    border-radius: 4px;
    border: 1px solid var(--border);
  }

  /* FAQ */
  .faq {
    padding: 60px 0 100px;
    border-top: 1px solid var(--border);
  }
  .faq h2 {
    text-align: center;
    margin-bottom: 40px;
  }
  .faq-list {
    max-width: 680px;
    margin: 0 auto;
  }
  details {
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-bottom: 12px;
    background: var(--bg-card);
    overflow: hidden;
  }
  summary {
    padding: 18px 24px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    color: var(--text);
    list-style: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  summary::-webkit-details-marker { display: none; }
  summary::after {
    content: '+';
    font-size: 20px;
    color: var(--text-muted);
    font-weight: 400;
    flex-shrink: 0;
    margin-left: 16px;
    transition: transform 0.2s;
  }
  details[open] summary::after {
    content: '\2212';
  }
  details p {
    padding: 0 24px 18px;
    font-size: 14px;
    color: var(--text-muted);
    line-height: 1.7;
  }

  /* Responsive */
  @media (max-width: 1100px) {
    .cards-grid {
      grid-template-columns: repeat(2, 1fr);
      max-width: 700px;
      margin: 0 auto;
    }
  }
  @media (max-width: 640px) {
    .cards-grid {
      grid-template-columns: 1fr;
      max-width: 420px;
    }
    .pricing-card.featured {
      order: -1;
    }
    .pricing-hero {
      padding: 70px 0 24px;
    }
    .pricing-hero h1 {
      font-size: 32px;
    }
    .pricing-cards {
      padding: 20px 0 50px;
    }
  }
</style>
